
### 什么是上传文件漏洞
上传文件漏洞也是一种常见的 web 漏洞，攻击者可以用利用服务器端的上传文件漏洞绕过安全验证将代码提交到服务器端，并想办法让代码文件被执行。一旦可执行的代码上传成功，会造成比较严重的安全问题，比如获取服务器权限，为攻击者开后门，或者让服务器超载，破坏服务器的可用性，甚至是上传病毒，木马等后果。  

简单来说，假如我们允许用户上传图片并展示到页面，在没有校验图片是否正常的情况下，就有可能会导致执行用户上传的非图片恶意文件。  

### 文件上传漏洞的防范
文件上传漏洞主要有以下防范措施：  

- 对文件类型做校验：通过白名单方式判断文件类型和扩展名是否是程序需要的，不过文件类型不一定可靠，容易被伪造。但作为基础校验，可以防止一些低级的文件注入攻击，也可以防止上传一些垃圾数据。  
- 将上传文件和应用程序分开存储：对于大型网站，用户上传的文件往往保存在单独的服务器中，和应用程序是分开的，比如上传到 cdn 服务器上，用户保存文件的服务器只提供基本的文件存取功能，不提供脚本执行能力。另外，还有对用户上传的数据做二次离线校验，遇到木马，色情图片等文件要及时删除，避免被正常用户下载。  
- 对上传的图片进行重绘：脚本可以通过图片执行，而图片又是正常的图片，可以修改文件尺寸（比如放大或缩小 1 个像素）、分辨率等方式重新创建一张图片，这个重绘的过程会破坏掉原图中的脚本。  
- 合理设置服务器权限：对于应用服务器程序，如果不在本机存储文件，可以去掉应用程序所在目录的写权限。对于文件服务器，可以去掉可执行权限。
- 对上传文件重命名：对上传文件重新命名，最好具有一定的随机性，提高攻击成本。
